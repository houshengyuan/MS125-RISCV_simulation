# RISCV5
1.综述：
     本项目为并行式五级流水RISCV指令集处理器，共经历了四次重构，本版为最终版本RISCV5。
     第一版为串行式五级流水，其中ID的相应功能被写入了EX中。第二版将本属于ID中的功能从EX中分离，加入了ID模块中。第三版为串行式指令模拟处理器的最终版本，将EX中的lw，lh，lb操作从EX中分离了出来放入MA模块之中。并改变了前两版不同模块之间引用传递的做法，加入4个buffer作为不同模块之间值传递的载体。第四版完成了从串行式向并行式的转换，并且添加了forwarding的功能。第五版在第四版的基础上加入了分支预测的功能。
2.项目基本思路与内容解释：
    分支预测采用分析预测记录进行预测，一开始预测不跳转，若出现连续三次的跳转，则一直预测跳转直至出现新的不跳转，按此不断往复。forwarding功能的实现使用map容器，若某操作在EX阶段需要改变寄存器中的值，则将其rd和值的信息添加入map中表示寄存器中rd存储值的改变信息，该操作WB阶段结束后再将该信息从map中删去，若添加时rd有重叠，则将原有信息覆盖。EX阶段单独设置所有类型的class方便操作，enum头文件存储了所有全局变量。
3.项目完善(debug):
本次项目五个版本共debug出了二十余处错误，其中比较典型的如下：
（1）基本知识出现问题，一些细节没有认真听，将0x当成二进制，返回语句少了&，一开始没有采用sign extended。
（2）运行过程没有考虑全面，忽视一些特殊情况
例如：分支预测可能会出现连续两次的预测状况（连续两次的条件判断）
      如果第一次预测失败，则第二次预测时初始地址pc可能已在第二次预测操作IF阶段被改变，此时第二次预测类型操作的IF阶段是无效的，如果仍然使用当前的pc就会出错
      如果第一次预测成功，则第二次预测时初始地址pc也会被改变但是是有效的，预测时在IF阶段应当采用此地址，如果只考虑了上面一种情况就会出现错误。
（3）采用string类进行操作的标识速度过慢，换成了enum类型
（4）不同buffer和操作箱之间的参数传递语句出现错误
3.项目运行结果：
五种版本皆通过了所有测试，分支预测的成功率如下（选取预测次数较多的作为参考）：
测试名称          预测总次数     预测成功次数    预测率1      
basicopt_1       158209        113220         0.715636
bulgarian        71533         47210          0.659975
hanoi            17459         8746           0.500945
magic            73568         38214          0.519438
naive            \             \              \
pi               4.10822e+07   2.93117e+07     0.713489
qsort            215946        145987         0.676035
queens           77118         50710          0.657564
superloop        488745        378717         0.774876
tak              60640         46105          0.760307
可以看到虽然预测成功率高于0.5，但成功率仍然较低
4.项目总结收获与反思:
     本项目对我的debug能力具有很大的提升作用，在这个过程中我总结出了许多有效方法：
（1）程序运行可视化是debug的前提，可以采用断点调试，中间过程变量输出的方法，其中中间变量可以由其他已运行通过的版本得到。
    切忌出现因一时找不到程序的错误点而盯着写好的代码死看的情况。
（2）必要时可以求助于同学，拿到成功代码运行的中间数据，相互比较以找出不同。

